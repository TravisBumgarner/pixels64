import time
import machine
import neopixel
import sys

# Add parent directory to path to import config
sys.path.append("..")
from config import get_led_index

NEO_PIXEL_PIN = 13
NEO_PIXEL_COUNT = 64

neo_pin = machine.Pin(NEO_PIXEL_PIN, machine.Pin.OUT)
np = neopixel.NeoPixel(neo_pin, NEO_PIXEL_COUNT)

# ============================================================================
# PASTE GENERATED IMAGE DATA HERE (from generated_images.txt)
# ============================================================================

# Example placeholder - replace with your generated data
# Generated image data - Copy this into display_images.py
# Replace the existing IMAGES dictionary with this code:

# From 01-2022-06-05 11.48.28
a01_2022_06_05_11_48_28 = [
    [
        (46, 23, 16),
        (110, 70, 38),
        (164, 110, 55),
        (101, 66, 40),
        (121, 104, 96),
        (131, 117, 104),
        (140, 130, 119),
        (120, 108, 100),
    ],
    [
        (41, 33, 37),
        (126, 103, 95),
        (113, 84, 72),
        (89, 58, 44),
        (77, 50, 29),
        (123, 100, 84),
        (155, 137, 115),
        (144, 138, 128),
    ],
    [
        (24, 25, 32),
        (161, 143, 130),
        (171, 157, 145),
        (117, 98, 90),
        (57, 45, 51),
        (88, 73, 65),
        (80, 91, 89),
        (95, 75, 64),
    ],
    [
        (31, 11, 10),
        (145, 153, 154),
        (187, 195, 194),
        (123, 106, 100),
        (90, 45, 37),
        (85, 60, 48),
        (83, 68, 53),
        (57, 25, 15),
    ],
    [
        (22, 4, 3),
        (111, 96, 90),
        (164, 143, 134),
        (118, 103, 98),
        (80, 55, 30),
        (99, 88, 72),
        (69, 84, 72),
        (46, 22, 17),
    ],
    [
        (23, 17, 9),
        (93, 89, 85),
        (108, 107, 105),
        (114, 109, 107),
        (77, 73, 69),
        (81, 62, 55),
        (58, 49, 52),
        (54, 41, 36),
    ],
    [
        (24, 17, 9),
        (57, 57, 55),
        (101, 95, 92),
        (114, 104, 99),
        (66, 41, 37),
        (33, 16, 16),
        (78, 69, 62),
        (72, 61, 54),
    ],
    [
        (16, 9, 9),
        (47, 40, 39),
        (132, 117, 109),
        (89, 72, 63),
        (37, 17, 13),
        (26, 15, 14),
        (56, 66, 79),
        (58, 52, 51),
    ],
]

# From 03-000070120029
a03_000070120029 = [
    [
        (88, 79, 71),
        (102, 87, 83),
        (103, 100, 100),
        (99, 114, 118),
        (100, 127, 132),
        (105, 141, 143),
        (114, 153, 151),
        (116, 159, 154),
    ],
    [
        (91, 86, 86),
        (96, 99, 105),
        (98, 118, 130),
        (101, 136, 147),
        (110, 155, 161),
        (122, 172, 173),
        (137, 185, 180),
        (143, 192, 184),
    ],
    [
        (94, 97, 101),
        (95, 118, 128),
        (102, 131, 138),
        (111, 153, 159),
        (124, 175, 178),
        (138, 186, 181),
        (154, 197, 191),
        (159, 200, 193),
    ],
    [
        (95, 99, 94),
        (102, 152, 170),
        (122, 155, 150),
        (124, 161, 156),
        (133, 190, 192),
        (141, 185, 180),
        (160, 204, 200),
        (167, 211, 206),
    ],
    [
        (86, 59, 34),
        (86, 91, 84),
        (124, 121, 100),
        (160, 109, 56),
        (153, 117, 73),
        (156, 121, 74),
        (171, 133, 81),
        (161, 130, 84),
    ],
    [
        (86, 60, 39),
        (82, 54, 33),
        (100, 65, 36),
        (126, 80, 40),
        (123, 74, 34),
        (121, 73, 33),
        (118, 72, 32),
        (115, 69, 31),
    ],
    [
        (88, 60, 39),
        (90, 62, 42),
        (88, 61, 42),
        (85, 58, 41),
        (85, 59, 42),
        (85, 59, 43),
        (87, 59, 42),
        (88, 60, 43),
    ],
    [
        (93, 65, 45),
        (95, 68, 48),
        (90, 60, 43),
        (92, 61, 43),
        (93, 63, 44),
        (93, 64, 44),
        (93, 62, 43),
        (93, 62, 43),
    ],
]

# From 05-2022-09-14 18.13.48
a05_2022_09_14_18_13_48 = [
    [
        (71, 110, 135),
        (114, 141, 164),
        (148, 171, 193),
        (158, 180, 202),
        (156, 178, 201),
        (164, 189, 212),
        (164, 187, 207),
        (172, 196, 212),
    ],
    [
        (107, 135, 157),
        (134, 156, 178),
        (143, 164, 186),
        (181, 195, 208),
        (179, 194, 208),
        (169, 188, 205),
        (188, 203, 217),
        (177, 196, 211),
    ],
    [
        (92, 123, 146),
        (77, 115, 142),
        (135, 156, 176),
        (194, 201, 209),
        (168, 182, 196),
        (132, 155, 176),
        (97, 131, 158),
        (79, 118, 147),
    ],
    [
        (77, 111, 133),
        (62, 102, 126),
        (46, 92, 123),
        (59, 103, 134),
        (55, 99, 132),
        (27, 86, 121),
        (24, 83, 118),
        (31, 84, 117),
    ],
    [
        (101, 127, 148),
        (115, 135, 156),
        (112, 134, 155),
        (105, 130, 153),
        (108, 131, 153),
        (109, 133, 154),
        (107, 132, 153),
        (103, 127, 149),
    ],
    [
        (100, 125, 145),
        (98, 124, 145),
        (103, 126, 148),
        (108, 128, 150),
        (108, 129, 150),
        (111, 132, 153),
        (105, 128, 149),
        (95, 122, 143),
    ],
    [
        (92, 119, 140),
        (91, 120, 141),
        (89, 116, 139),
        (88, 116, 138),
        (88, 115, 138),
        (93, 119, 141),
        (86, 115, 137),
        (77, 109, 132),
    ],
    [
        (55, 93, 119),
        (68, 101, 126),
        (83, 112, 133),
        (86, 114, 136),
        (83, 111, 134),
        (82, 112, 133),
        (72, 105, 128),
        (66, 101, 125),
    ],
]

# From 04-DJI_0089
a04_DJI_0089 = [
    [
        (0, 112, 77),
        (0, 114, 73),
        (0, 116, 75),
        (0, 114, 74),
        (0, 112, 68),
        (1, 111, 69),
        (1, 110, 74),
        (0, 110, 80),
    ],
    [
        (0, 118, 79),
        (0, 118, 76),
        (0, 123, 79),
        (0, 119, 76),
        (1, 122, 79),
        (1, 118, 81),
        (1, 113, 75),
        (2, 111, 79),
    ],
    [
        (17, 126, 84),
        (12, 131, 82),
        (3, 135, 82),
        (0, 132, 80),
        (0, 131, 84),
        (1, 123, 84),
        (1, 116, 79),
        (3, 120, 84),
    ],
    [
        (51, 124, 86),
        (40, 128, 84),
        (26, 132, 84),
        (24, 140, 90),
        (18, 140, 91),
        (6, 129, 82),
        (5, 119, 83),
        (4, 119, 88),
    ],
    [
        (80, 127, 104),
        (54, 124, 87),
        (39, 123, 82),
        (26, 124, 81),
        (33, 130, 89),
        (29, 129, 89),
        (23, 125, 85),
        (19, 120, 86),
    ],
    [
        (186, 182, 174),
        (100, 132, 112),
        (38, 103, 68),
        (20, 98, 66),
        (23, 111, 81),
        (31, 117, 91),
        (36, 119, 87),
        (46, 124, 86),
    ],
    [
        (219, 214, 210),
        (209, 199, 192),
        (126, 138, 122),
        (63, 100, 75),
        (44, 94, 69),
        (37, 100, 77),
        (36, 110, 90),
        (41, 114, 91),
    ],
    [
        (187, 197, 202),
        (217, 213, 209),
        (223, 212, 203),
        (166, 165, 154),
        (101, 122, 104),
        (67, 105, 81),
        (47, 101, 82),
        (47, 108, 93),
    ],
]

# From 06-DSC_0711
a06_DSC_0711 = [
    [
        (118, 48, 1),
        (130, 56, 3),
        (143, 68, 23),
        (146, 73, 35),
        (141, 69, 26),
        (154, 77, 30),
        (161, 83, 35),
        (164, 89, 42),
    ],
    [
        (118, 48, 1),
        (128, 53, 0),
        (142, 67, 20),
        (145, 72, 34),
        (137, 63, 19),
        (150, 73, 24),
        (158, 80, 31),
        (157, 82, 35),
    ],
    [
        (117, 46, 1),
        (128, 52, 0),
        (140, 65, 19),
        (141, 68, 30),
        (132, 59, 13),
        (147, 70, 21),
        (153, 75, 26),
        (154, 79, 32),
    ],
    [
        (114, 45, 1),
        (124, 50, 0),
        (133, 60, 15),
        (136, 64, 24),
        (130, 58, 9),
        (139, 63, 13),
        (146, 69, 19),
        (147, 73, 26),
    ],
    [
        (109, 41, 1),
        (117, 45, 0),
        (120, 52, 10),
        (123, 55, 13),
        (122, 51, 2),
        (125, 55, 6),
        (136, 62, 11),
        (135, 64, 16),
    ],
    [
        (100, 37, 2),
        (103, 36, 0),
        (120, 63, 22),
        (152, 114, 72),
        (134, 87, 46),
        (115, 50, 6),
        (127, 57, 6),
        (121, 55, 7),
    ],
    [
        (90, 31, 2),
        (90, 29, 0),
        (111, 60, 25),
        (126, 85, 51),
        (99, 41, 10),
        (109, 44, 1),
        (115, 51, 3),
        (109, 49, 3),
    ],
    [
        (79, 25, 1),
        (84, 29, 1),
        (81, 27, 1),
        (79, 23, 0),
        (90, 31, 0),
        (101, 41, 1),
        (105, 45, 1),
        (100, 45, 2),
    ],
]

# From 01-DJI_0276
a01_DJI_0276 = [
    [
        (74, 146, 208),
        (62, 139, 203),
        (53, 132, 199),
        (46, 126, 194),
        (39, 121, 189),
        (31, 115, 184),
        (26, 111, 179),
        (25, 110, 177),
    ],
    [
        (99, 164, 220),
        (85, 156, 216),
        (72, 148, 212),
        (61, 141, 206),
        (54, 135, 202),
        (50, 131, 198),
        (47, 128, 195),
        (43, 125, 192),
    ],
    [
        (128, 183, 230),
        (118, 178, 228),
        (105, 171, 224),
        (98, 170, 224),
        (88, 164, 221),
        (75, 153, 212),
        (70, 148, 209),
        (66, 144, 206),
    ],
    [
        (178, 221, 253),
        (169, 216, 250),
        (162, 214, 250),
        (142, 194, 231),
        (131, 186, 226),
        (140, 200, 241),
        (130, 190, 234),
        (124, 185, 230),
    ],
    [
        (137, 158, 175),
        (144, 163, 179),
        (146, 165, 180),
        (113, 129, 143),
        (116, 133, 146),
        (157, 173, 182),
        (154, 170, 179),
        (153, 169, 178),
    ],
    [
        (103, 103, 101),
        (116, 112, 108),
        (122, 118, 114),
        (123, 120, 115),
        (130, 126, 120),
        (143, 139, 132),
        (144, 141, 134),
        (134, 133, 129),
    ],
    [
        (134, 132, 127),
        (148, 145, 139),
        (155, 152, 147),
        (149, 142, 133),
        (148, 140, 129),
        (154, 146, 132),
        (157, 147, 130),
        (137, 131, 119),
    ],
    [
        (157, 158, 152),
        (151, 149, 142),
        (152, 147, 138),
        (168, 163, 153),
        (166, 162, 152),
        (161, 154, 140),
        (160, 153, 136),
        (155, 147, 129),
    ],
]

# From 02-Foto-21
a02_FOTO_21 = [
    [
        (22, 24, 19),
        (21, 24, 19),
        (41, 40, 43),
        (72, 63, 85),
        (65, 59, 81),
        (110, 102, 126),
        (189, 182, 193),
        (212, 205, 211),
    ],
    [
        (65, 61, 69),
        (51, 50, 54),
        (62, 58, 69),
        (65, 60, 81),
        (58, 56, 76),
        (51, 47, 67),
        (127, 124, 138),
        (187, 181, 191),
    ],
    [
        (95, 91, 104),
        (82, 79, 92),
        (60, 61, 69),
        (97, 92, 103),
        (98, 92, 99),
        (181, 169, 172),
        (246, 229, 233),
        (233, 218, 222),
    ],
    [
        (119, 114, 128),
        (108, 98, 115),
        (91, 81, 98),
        (145, 128, 145),
        (121, 108, 116),
        (194, 181, 184),
        (210, 199, 206),
        (183, 179, 184),
    ],
    [
        (87, 85, 106),
        (171, 160, 175),
        (215, 204, 214),
        (238, 227, 231),
        (227, 219, 220),
        (216, 209, 211),
        (181, 179, 184),
        (222, 222, 222),
    ],
    [
        (92, 87, 94),
        (232, 223, 225),
        (220, 222, 217),
        (133, 138, 135),
        (139, 145, 142),
        (240, 237, 235),
        (255, 255, 255),
        (255, 255, 253),
    ],
    [
        (186, 164, 172),
        (167, 148, 156),
        (62, 60, 61),
        (111, 112, 112),
        (99, 100, 100),
        (114, 117, 114),
        (211, 205, 204),
        (198, 192, 190),
    ],
    [
        (202, 171, 184),
        (149, 122, 134),
        (80, 72, 75),
        (126, 122, 125),
        (122, 118, 119),
        (58, 55, 55),
        (77, 70, 70),
        (74, 67, 67),
    ],
]

# From 07-DSC08342
a07_DSC08342 = [
    [
        (83, 94, 112),
        (88, 105, 128),
        (82, 100, 122),
        (82, 96, 112),
        (103, 60, 13),
        (110, 59, 2),
        (134, 85, 1),
        (108, 66, 6),
    ],
    [
        (125, 157, 196),
        (126, 159, 194),
        (68, 82, 86),
        (73, 76, 75),
        (47, 24, 25),
        (42, 12, 7),
        (180, 123, 25),
        (176, 128, 26),
    ],
    [
        (157, 189, 228),
        (152, 186, 221),
        (97, 120, 127),
        (110, 118, 119),
        (54, 30, 27),
        (51, 19, 10),
        (210, 158, 53),
        (222, 180, 62),
    ],
    [
        (149, 178, 208),
        (144, 176, 202),
        (104, 131, 140),
        (120, 131, 135),
        (60, 30, 27),
        (55, 16, 8),
        (169, 94, 39),
        (171, 103, 42),
    ],
    [
        (151, 180, 215),
        (149, 179, 210),
        (104, 136, 146),
        (123, 134, 140),
        (58, 28, 25),
        (49, 10, 4),
        (125, 17, 11),
        (118, 14, 10),
    ],
    [
        (155, 186, 222),
        (153, 187, 219),
        (123, 151, 162),
        (137, 143, 147),
        (71, 29, 26),
        (65, 16, 9),
        (131, 23, 9),
        (127, 23, 12),
    ],
    [
        (124, 153, 178),
        (119, 150, 175),
        (199, 205, 206),
        (190, 181, 178),
        (115, 35, 28),
        (131, 39, 27),
        (122, 22, 14),
        (125, 24, 16),
    ],
    [
        (138, 109, 115),
        (145, 116, 120),
        (186, 159, 156),
        (164, 144, 130),
        (142, 87, 74),
        (158, 106, 93),
        (155, 102, 96),
        (154, 96, 94),
    ],
]

IMAGES = {
    "01-2022-06-05 11.48.28": a01_2022_06_05_11_48_28,
    "03-000070120029": a03_000070120029,
    "05-2022-09-14 18.13.48": a05_2022_09_14_18_13_48,
    "04-DJI_0089": a04_DJI_0089,
    "06-DSC_0711": a06_DSC_0711,
    "01-DJI_0276": a01_DJI_0276,
    "02-Foto-21": a02_FOTO_21,
    "07-DSC08342": a07_DSC08342,
}

# ============================================================================


def display_image(color_grid):
    """Display a single 8x8 color grid on the LED matrix."""
    if not color_grid:
        return

    for y in range(8):
        for x in range(8):
            if y < len(color_grid) and x < len(color_grid[y]):
                color = color_grid[y][x]
                led_index = get_led_index(y, x)
                if led_index is not None:
                    np[led_index] = color

    np.write()


def display_images():
    """Main display function that cycles through all available images."""
    if not IMAGES:
        print(
            "No images found! Please run process_images.py and copy the generated code."
        )
        # Display a simple pattern to show the display is working
        for i in range(64):
            np[i] = (32, 32, 32)  # Dim white
        np.write()
        return

    image_names = list(IMAGES.keys())
    print(f"Found {len(image_names)} images to display")

    current_index = 0

    while True:
        image_name = image_names[current_index]
        print(f"Displaying: {image_name}")

        # Display the image
        color_grid = IMAGES[image_name]
        display_image(color_grid)

        # Wait 10 seconds before switching to next image
        time.sleep(10)

        # Move to next image (cycle back to start when done)
        current_index = (current_index + 1) % len(image_names)


if __name__ == "__main__":
    display_images()
